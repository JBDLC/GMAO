{% extends "base.html" %}
{% block title %}Check List - {{ template.name }}{% endblock %}
{% block content %}
<style>
  .page-header {
    margin-top: 2rem;
    margin-bottom: 2rem;
  }
  .page-title {
    color: #1a3b50;
    font-weight: 700;
    font-size: 2rem;
    letter-spacing: -0.5px;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .page-title::before {
    content: '';
    width: 4px;
    height: 32px;
    background: linear-gradient(135deg, #1a3b50 0%, #03192f 100%);
    border-radius: 2px;
  }
  .info-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }
  .info-card h5 {
    color: #1a3b50;
    font-weight: 600;
    margin-bottom: 1rem;
  }
  .row-card {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    padding: 1.5rem;
    margin-bottom: 1rem;
  }
  .row-card h6 {
    color: #1a3b50;
    font-weight: 600;
    margin-bottom: 1rem;
  }
  .value-item {
    margin-bottom: 0.75rem;
  }
  .value-item:last-child {
    margin-bottom: 0;
  }
  .value-label {
    font-weight: 600;
    color: #495057;
    margin-bottom: 0.25rem;
  }
  .value-content {
    color: #212529;
    padding: 0.5rem 0.75rem;
    background: white;
    border-radius: 4px;
    border: 1px solid #dee2e6;
  }
  .admin-value {
    background: #e9ecef;
    color: #495057;
    font-weight: 500;
  }
  .table {
    margin-bottom: 0;
  }
  .table thead th {
    background-color: #1a3b50;
    color: white;
    font-weight: 600;
    vertical-align: middle;
    text-align: center;
  }
  .table tbody td {
    vertical-align: middle;
  }
  .table tbody tr:first-child td:first-child {
    background-color: #f8f9fa;
  }
  .value-content {
    padding: 0.5rem;
    text-align: center;
  }
  .btn-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
    color: white;
    font-weight: 500;
  }
  .btn-secondary:hover {
    background-color: #5a6268;
    border-color: #5a6268;
    color: white;
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .info-card {
      padding: 1rem;
    }
    
    .d-flex.justify-content-between {
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .btn-secondary {
      width: 100%;
    }
  }
  
  @media (max-width: 576px) {
    .info-card {
      padding: 0.75rem;
    }
  }
</style>

<div class="page-header">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb mb-1">
      <li class="breadcrumb-item"><a href="{{ url_for('machines') }}">Machines</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('machine_detail', machine_id=machine.id) }}">{{ machine.name }}</a></li>
      <li class="breadcrumb-item active">Check List</li>
    </ol>
  </nav>
  <h1 class="page-title">{{ template.name }}</h1>
</div>

<div class="info-card">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <span>Remplie le {{ instance.created_at.strftime("%d/%m/%Y %H:%M") }}</span>
    {% if instance.user %}
    <span class="text-muted">par {{ instance.user.username }}</span>
    {% endif %}
  </div>
</div>

{% if template.rows and template.columns %}
  <div class="table-responsive">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th style="min-width: 150px;">Ligne</th>
          {% for column in template.columns %}
          <th>
            {{ column.name }}
            {% if column.has_unit %}
              <small class="text-muted d-block">(unité par ligne)</small>
            {% endif %}
          </th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for template_row in template.rows %}
        <tr>
          <td class="fw-bold">Ligne {{ loop.index }}</td>
          {% for column in template.columns %}
            {% set row_value = template_row.admin_values|selectattr('column_id', 'equalto', column.id)|first %}
            <td>
              <div class="value-content">
                {% if column.fill_type == 'admin' %}
                  {{ row_value.value if row_value else '' }}{% if row_value and row_value.unit %} {{ row_value.unit }}{% endif %}
                {% else %}
                  {% set instance_value = instance.row_values|selectattr('template_row_id', 'equalto', template_row.id)|selectattr('column_id', 'equalto', column.id)|first %}
                  {% if instance_value and instance_value.value %}
                    {% if column.fill_type == 'user_checkbox' %}
                      {% if instance_value.value == 'on' %}
                        <span class="badge bg-success">✓</span>
                      {% else %}
                        <span class="badge bg-secondary">✗</span>
                      {% endif %}
                    {% else %}
                      {{ instance_value.value }}
                    {% endif %}
                  {% else %}
                    <span class="text-muted fst-italic">Non renseigné</span>
                  {% endif %}
                {% endif %}
              </div>
            </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="info-card">
    <p class="text-muted mb-0">Aucune ligne définie dans cette checklist.</p>
  </div>
{% endif %}

{% if instance.comment %}
<div class="info-card">
  <h5>Commentaire</h5>
  <p class="text-muted">{{ instance.comment }}</p>
</div>
{% endif %}

<div class="mt-3">
  <a href="{{ url_for('machine_detail', machine_id=machine.id) }}" class="btn btn-secondary">Retour</a>
</div>
{% endblock %}
